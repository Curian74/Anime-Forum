@model WibuBlog.ViewModels.Ticket.TicketDetailVM

<div class="container mt-4 p-4 border rounded shadow-sm bg-light" style="max-width: 600px;">
    <h2 class="mb-3 text-center">Ticket Details</h2>

    <form asp-action="Update" asp-controller="Ticket" asp-route-id="@Model.Id" method="post" id="ticketForm">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success" role="alert">
                @TempData["SuccessMessage"]
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger" role="alert">
                @TempData["ErrorMessage"]
            </div>
        }

        <div class="mb-3">
            <label asp-for="Email" class="fw-bold mt-3">Email</label>
            <input asp-for="Email" class="form-control" placeholder="Enter your email" readonly>
            <span class="text-danger" asp-validation-for="Email"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Content" class="fw-bold">Content</label>
            <div id="editor-container" class="border rounded p-2 bg-white" style="height: 200px;"></div>
            <input type="hidden" asp-for="Content" id="content-input">
            <span class="text-danger" asp-validation-for="Content"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Tag" class="fw-bold mt-3">Tag</label>
            <select asp-for="Tag" class="form-select" disabled>
                <option value="#BannedAccount">🔒 Banned Account</option>
                <option value="#HelpCreatePost">✍️ Help Create Post</option>
                <option value="#TechnicalIssue">⚙️ Technical Issue</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="fw-bold">Status</label>
            <div class="form-control @(Model.IsApproved == true ? "bg-success text-white" : Model.IsApproved == false ? "bg-danger text-white" : "bg-warning text-dark")">
                @(Model.IsApproved == true ? "Approved" : Model.IsApproved == false ? "Rejected" : "Pending")
            </div>
        </div>

        <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary flex-grow-1">
                <i class="bi bi-save"></i> Update Ticket
            </button>

            @if (Model.IsApproved == null)
            {
                <button type="button" class="btn btn-danger flex-grow-1" data-bs-toggle="modal" data-bs-target="#cancelModal">
                    <i class="bi bi-x-circle"></i> Cancel Ticket
                </button>
            }
        </div>
    </form>

    <div class="d-flex justify-content-between mt-3">
        <a asp-action="Index" asp-controller="Ticket" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to List
        </a>
    </div>
</div>

<!-- Cancel Confirmation Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelModalLabel">Confirm Cancellation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to cancel this ticket? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <form asp-action="Cancel" asp-controller="Ticket" asp-route-id="@Model.Id" method="post">
                    <button type="submit" class="btn btn-danger">Confirm Cancel</button>
                </form>
            </div>
        </div>
    </div>
</div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var quill = new Quill('#editor-container', {
            theme: 'snow',
            placeholder: 'Describe your issue...',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    ['image']
                ]
            }
        });

        // Initialize with existing content
        var content = document.querySelector('#content-input').value;
        if (content) {
            quill.root.innerHTML = content;
        }

        // Update hidden input on text change
        quill.on('text-change', function() {
            document.querySelector('#content-input').value = quill.root.innerHTML;
        });

        // Display ticket status with color
        const statusElement = document.querySelector('#ticket-status');
        if (statusElement) {
            const status = statusElement.textContent.trim();
            if (status === 'Approved') {
                statusElement.classList.add('bg-success', 'text-white');
            } else if (status === 'Rejected') {
                statusElement.classList.add('bg-danger', 'text-white');
            } else {
                statusElement.classList.add('bg-warning', 'text-dark');
            }
        }
    });
</script>